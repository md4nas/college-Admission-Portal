<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::Layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Applications Management</title>
</head>
<body>

<section>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-info text-white">
                    <div class="card-body text-center py-4">
                        <i class='bx bx-file-blank' style="font-size: 3rem;"></i>
                        <h2 class="mt-3 mb-2">Applications Management</h2>
                        <p class="mb-0">Review and approve student applications</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Success/Error Messages -->
        <div th:if="${session.msg}" th:class="'alert alert-' + ${session.msgType}" class="alert alert-dismissible fade show">
            <span th:text="${session.msg}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Applications Table -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4><i class='bx bx-list-ul me-2'></i>Submitted Applications (Ranked by Marks)</h4>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(applications)}" class="text-center py-5">
                            <i class='bx bx-inbox text-muted' style="font-size: 4rem;"></i>
                            <h5 class="mt-3 text-muted">No Applications Found</h5>
                            <p class="text-muted">No student applications are pending for review.</p>
                        </div>

                        <div th:if="${#lists.isEmpty(applications)}" class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Rank</th>
                                        <th>Student Details</th>
                                        <th>Course & Preferences</th>
                                        <th>Class 12 Marks</th>
                                        <th>Percentage</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="app, iterStat : ${applications}">
                                        <td>
                                            <span class="badge bg-warning text-dark fs-6" th:text="${iterStat.count}"></span>
                                        </td>
                                        <td>
                                            <div>
                                                <strong th:text="${app.userEmail}"></strong>
                                                <br>
                                                <small class="text-muted">
                                                    <i class='bx bx-phone'></i> <span th:text="${app.phoneNo}"></span>
                                                </small>
                                            </div>
                                        </td>
                                        <td>
                                            <div>
                                                <span class="badge bg-info" th:text="${app.course}"></span>
                                                <br>
                                                <small>
                                                    1st: <strong th:text="${app.branch1}"></strong><br>
                                                    2nd: <strong th:text="${app.branch2}"></strong>
                                                </small>
                                            </div>
                                        </td>
                                        <td>
                                            <strong th:text="${app.obtain12Marks} + '/' + ${app.total12Marks}"></strong>
                                            <br>
                                            <small class="text-muted">
                                                P: <span th:text="${app.class12Physics}"></span> |
                                                C: <span th:text="${app.class12Chemistry}"></span> |
                                                M: <span th:text="${app.class12Maths}"></span>
                                            </small>
                                        </td>
                                        <td>
                                            <span class="badge bg-success fs-6" th:text="${app.percentage12} + '%'"></span>
                                        </td>
                                        <td>
                                            <span th:switch="${app.status}">
                                                <span th:case="'SUBMITTED'" class="badge bg-info">Submitted</span>
                                                <span th:case="'APPROVED'" class="badge bg-success">Approved</span>
                                                <span th:case="'REJECTED'" class="badge bg-danger">Rejected</span>
                                            </span>
                                        </td>
                                        <td>
                                            <div th:if="${app.status == 'SUBMITTED'}" class="btn-group-vertical btn-group-sm">
                                                <form th:action="@{/teacher/applications/approve}" method="post" class="d-inline">
                                                    <input type="hidden" name="applicationId" th:value="${app.id}">
                                                    <button type="submit" class="btn btn-success btn-sm mb-1">
                                                        <i class='bx bx-check'></i> Approve
                                                    </button>
                                                </form>
                                                <form th:action="@{/teacher/applications/reject}" method="post" class="d-inline">
                                                    <input type="hidden" name="applicationId" th:value="${app.id}">
                                                    <button type="submit" class="btn btn-danger btn-sm">
                                                        <i class='bx bx-x'></i> Reject
                                                    </button>
                                                </form>
                                            </div>
                                            <div th:if="${app.status != 'SUBMITTED'}">
                                                <small class="text-muted">Action completed</small>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="row mt-4">
            <div class="col-12 text-center">
                <a href="/teacher/" class="btn btn-secondary me-3">
                    <i class='bx bx-arrow-back'></i> Back to Dashboard
                </a>
                <a href="/teacher/applications/approved" class="btn btn-primary">
                    <i class='bx bx-trophy'></i> Seat Allocation
                </a>
            </div>
        </div>
    </div>
</section>

<script>
    // Auto-dismiss alerts after 5 seconds
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            if (alert.classList.contains('show')) {
                alert.classList.remove('show');
            }
        });
    }, 5000);
</script>

</body>
</html>