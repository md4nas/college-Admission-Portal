<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::Layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Seat Management</title>
</head>
<body>
<section>
    <div class="container-fluid">
        <div class="row mb-4">
            <div class="col-12">
                <h2><i class='bx bx-chair me-2 text-primary'></i>Seat Management</h2>
                <p class="text-muted">Manage student applications and seat allocations</p>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Student Applications</h5>
                    </div>
                    <div class="card-body p-0">
                        <div th:if="${applications != null and !applications.empty}">
                            <div class="table-responsive">
                                <table class="table table-hover mb-0">
                                    <thead class="bg-light">
                                        <tr>
                                            <th>#</th>
                                            <th>Student</th>
                                            <th>Phone</th>
                                            <th>Status</th>
                                            <th>Course</th>
                                            <th>Branch</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="app, iterStat : ${applications}">
                                            <td th:text="${iterStat.index + 1}">1</td>
                                            <td>
                                                <div th:text="${app?.parentsName ?: 'N/A'}">Student Name</div>
                                                <small class="text-muted" th:text="${app?.userEmail ?: 'N/A'}">email</small>
                                            </td>
                                            <td th:text="${app?.phoneNo ?: 'N/A'}">Phone</td>
                                            <td>
                                                <form th:action="@{/teacher/seat-management/update-status}" method="post" class="d-inline">
                                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                                    <input type="hidden" name="applicationId" th:value="${app?.id ?: ''}" />
                                                    <select name="status" class="form-select form-select-sm" onchange="this.form.submit()">
                                                        <option value="PENDING" th:selected="${app?.status == 'PENDING'}">Pending</option>
                                                        <option value="REVIEWED" th:selected="${app?.status == 'REVIEWED'}">Reviewed</option>
                                                        <option value="APPROVED" th:selected="${app?.status == 'APPROVED'}">Approved</option>
                                                        <option value="REJECTED" th:selected="${app?.status == 'REJECTED'}">Rejected</option>
                                                    </select>
                                                </form>
                                            </td>
                                            <td>
                                                <form th:action="@{/teacher/seat-management/update-course}" method="post" class="d-inline">
                                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                                    <input type="hidden" name="applicationId" th:value="${app?.id ?: ''}" />
                                                    <select name="course" class="form-select form-select-sm" onchange="this.form.submit()">
                                                        <option value="">Select Course</option>
                                                        <option value="BTECH" th:selected="${app?.course == 'BTECH'}">B.Tech</option>
                                                        <option value="MTECH" th:selected="${app?.course == 'MTECH'}">M.Tech</option>
                                                        <option value="BCA" th:selected="${app?.course == 'BCA'}">BCA</option>
                                                        <option value="MCA" th:selected="${app?.course == 'MCA'}">MCA</option>
                                                    </select>
                                                </form>
                                            </td>
                                            <td>
                                                <form th:action="@{/teacher/seat-management/update-branch}" method="post" class="d-inline">
                                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                                    <input type="hidden" name="applicationId" th:value="${app?.id ?: ''}" />
                                                    <select name="allocatedBranch" class="form-select form-select-sm" onchange="this.form.submit()">
                                                        <option value="">None</option>
                                                        <option value="CSE" th:selected="${app?.allocatedBranch == 'CSE'}">CSE</option>
                                                        <option value="ECE" th:selected="${app?.allocatedBranch == 'ECE'}">ECE</option>
                                                        <option value="MECHANICAL" th:selected="${app?.allocatedBranch == 'MECHANICAL'}">Mechanical</option>
                                                    </select>
                                                </form>
                                            </td>
                                            <td>
                                                <div th:if="${app?.id != null and !#strings.isEmpty(app.id)}">
                                                    <a th:href="@{/teacher/application-details/{id}(id=${app.id})}" 
                                                       class="btn btn-sm btn-outline-info rounded-pill">
                                                        <i class='bx bx-info-circle me-1'></i>View Details
                                                    </a>
                                                    <small class="text-muted d-block mt-1">ID: <span th:text="${app.id}">N/A</span></small>
                                                </div>
                                                <div th:if="${app?.id == null or #strings.isEmpty(app.id)}">
                                                    <span class="text-muted">No ID Available</span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div th:if="${applications == null or applications.empty}" class="text-center py-5">
                            <p class="text-muted">No applications found</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>