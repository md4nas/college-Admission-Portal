<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{base::Layout(~{::section})}">
<head>
    <meta charset="UTF-8">
    <title>Statistics Dashboard - Admin</title>
</head>
<body>

<section>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card bg-success text-white">
                    <div class="card-body text-center py-4">
                        <i class='bx bx-bar-chart' style="font-size: 3rem;"></i>
                        <h2 class="mt-3 mb-2">Statistics Dashboard</h2>
                        <p class="mb-0">Comprehensive analytics and reports for college admissions</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status-wise Statistics -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h4><i class='bx bx-pie-chart me-2'></i>Application Status Distribution</h4>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(statusCounts)}" class="text-center py-4">
                            <i class='bx bx-inbox text-muted' style="font-size: 3rem;"></i>
                            <h5 class="mt-3 text-muted">No Data Available</h5>
                            <p class="text-muted">No applications have been submitted yet.</p>
                        </div>

                        <div th:if="${!#lists.isEmpty(statusCounts)}" class="row">
                            <div th:each="statusCount : ${statusCounts}" class="col-md-3 mb-3">
                                <div class="card border-0 shadow-sm">
                                    <div class="card-body text-center">
                                        <div th:switch="${statusCount[0]}">
                                            <div th:case="'PENDING'">
                                                <i class='bx bx-time-five text-secondary' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-secondary" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Pending</p>
                                            </div>
                                            <div th:case="'SUBMITTED'">
                                                <i class='bx bx-check text-info' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-info" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Submitted</p>
                                            </div>
                                            <div th:case="'APPROVED'">
                                                <i class='bx bx-check-circle text-success' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-success" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Approved</p>
                                            </div>
                                            <div th:case="'ALLOCATED'">
                                                <i class='bx bx-trophy text-primary' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-primary" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Allocated</p>
                                            </div>
                                            <div th:case="'ACCEPTED'">
                                                <i class='bx bx-medal text-success' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-success" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Accepted</p>
                                            </div>
                                            <div th:case="'DECLINED'">
                                                <i class='bx bx-x-circle text-warning' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-warning" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Declined</p>
                                            </div>
                                            <div th:case="'REJECTED'">
                                                <i class='bx bx-x text-danger' style="font-size: 3rem;"></i>
                                                <h4 class="mt-2 text-danger" th:text="${statusCount[1]}"></h4>
                                                <p class="text-muted mb-0">Rejected</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Branch-wise Statistics -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h4><i class='bx bx-building me-2'></i>Branch-wise Allocation Statistics</h4>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(branchStats)}" class="text-center py-4">
                            <i class='bx bx-building text-muted' style="font-size: 3rem;"></i>
                            <h5 class="mt-3 text-muted">No Branch Allocations</h5>
                            <p class="text-muted">No seats have been allocated to any branch yet.</p>
                        </div>

                        <div th:if="${!#lists.isEmpty(branchStats)}" class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Branch</th>
                                        <th>Total Allocated</th>
                                        <th>Average Marks</th>
                                        <th>Performance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="branchStat : ${branchStats}">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <i class='bx bx-building text-primary me-2' style="font-size: 1.5rem;"></i>
                                                <strong th:text="${branchStat[0]}"></strong>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-primary fs-6" th:text="${branchStat[1]}"></span>
                                        </td>
                                        <td>
                                            <span class="badge bg-success fs-6" th:text="${#numbers.formatDecimal(branchStat[2], 1, 1)}"></span>
                                        </td>
                                        <td>
                                            <div class="progress" style="height: 20px;">
                                                <div class="progress-bar bg-success" 
                                                     th:style="'width: ' + ${(branchStat[2] / 500) * 100} + '%'"
                                                     th:text="${#numbers.formatDecimal((branchStat[2] / 500) * 100, 1, 1)} + '%'">
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Performers -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h4><i class='bx bx-trophy me-2'></i>Top 10 Performers</h4>
                    </div>
                    <div class="card-body">
                        <div th:if="${#lists.isEmpty(applications)}" class="text-center py-4">
                            <i class='bx bx-trophy text-muted' style="font-size: 3rem;"></i>
                            <h5 class="mt-3 text-muted">No Applications</h5>
                            <p class="text-muted">No applications available to show top performers.</p>
                        </div>

                        <div th:if="${!#lists.isEmpty(applications)}" class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Rank</th>
                                        <th>Student</th>
                                        <th>Percentage</th>
                                        <th>Marks</th>
                                        <th>Branch Preference</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="app, iterStat : ${applications}" th:if="${iterStat.count <= 10}">
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span th:if="${iterStat.count == 1}" class="badge bg-warning text-dark fs-5">🥇 1st</span>
                                                <span th:if="${iterStat.count == 2}" class="badge bg-secondary text-white fs-5">🥈 2nd</span>
                                                <span th:if="${iterStat.count == 3}" class="badge bg-warning text-dark fs-5">🥉 3rd</span>
                                                <span th:if="${iterStat.count > 3}" class="badge bg-primary fs-5" th:text="${iterStat.count}"></span>
                                            </div>
                                        </td>
                                        <td>
                                            <div>
                                                <strong th:text="${app.userEmail}"></strong>
                                                <br>
                                                <small class="text-muted" th:text="${app.city}"></small>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-success fs-6" th:text="${app.percentage12} + '%'"></span>
                                        </td>
                                        <td>
                                            <strong th:text="${app.obtain12Marks} + '/' + ${app.total12Marks}"></strong>
                                        </td>
                                        <td>
                                            <div>
                                                <span class="badge bg-info" th:text="${app.branch1}"></span>
                                                <br>
                                                <small class="text-muted" th:text="'2nd: ' + ${app.branch2}"></small>
                                            </div>
                                        </td>
                                        <td>
                                            <span th:switch="${app.status}">
                                                <span th:case="'SUBMITTED'" class="badge bg-info">Submitted</span>
                                                <span th:case="'APPROVED'" class="badge bg-success">Approved</span>
                                                <span th:case="'ALLOCATED'" class="badge bg-primary">Allocated</span>
                                                <span th:case="'ACCEPTED'" class="badge bg-success">Accepted</span>
                                                <span th:case="'REJECTED'" class="badge bg-danger">Rejected</span>
                                            </span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-secondary text-white">
                        <h4><i class='bx bx-cog me-2'></i>Quick Actions</h4>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <a href="/admin/applications" class="btn btn-outline-primary w-100">
                                    <i class='bx bx-list-ul'></i><br>
                                    View All Applications
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/admin/applications/status?status=SUBMITTED" class="btn btn-outline-info w-100">
                                    <i class='bx bx-time'></i><br>
                                    Pending Applications
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/admin/applications/status?status=ALLOCATED" class="btn btn-outline-success w-100">
                                    <i class='bx bx-trophy'></i><br>
                                    Allocated Seats
                                </a>
                            </div>
                            <div class="col-md-3 mb-3">
                                <a href="/admin/" class="btn btn-outline-secondary w-100">
                                    <i class='bx bx-home'></i><br>
                                    Admin Dashboard
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="row">
            <div class="col-12 text-center">
                <a href="/admin/" class="btn btn-secondary me-3">
                    <i class='bx bx-arrow-back'></i> Back to Dashboard
                </a>
                <a href="/admin/applications" class="btn btn-primary">
                    <i class='bx bx-table'></i> View Applications
                </a>
            </div>
        </div>
    </div>
</section>

</body>
</html>